<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play!</title>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
    <link rel="stylesheet" href="css/global.css">
</head>
<body onload="loaded()">
    <p style="background-color: yellow; color: red;">Swffy is under development, and this requires a Swffy server on port 5000, the default for Flask.<br>This page does not work without a ?gameid in the URL. A directory will be made available soon.</p>
    <div id="title"></div>
    <div id="flash">
    </div>
    <script>
        function loaded() {
            const urlParams = new URLSearchParams(window.location.search);
            const gid = urlParams.get('gameid');
            title.innerText = "Playing " + gid;
            let urlp = null;
            const options = {"swfname": gid}
            fetch("http://127.0.0.1:5000/api/getswf", {"method": "POST", headers: {'Content-Type': 'application/json'}, "body": JSON.stringify(options)})
                //.then(response => response.json())
                .then(res => JSON.parse(res.json()))
                .then(data => {
                    urlp = data.swfname;
                })
            urlrpce(urlp)
        }
        function urlrpce(urlp) {
            console.log("urlrpce executed!")
            //document.getElementById("fem").src = urlp;
            //document.getElementById("pars").value = urlp;
            //document.getElementById("fob").data = urlp;
            flash.innerHTML = '<object width="550" height="400" id="' + urlp + '" type="application/x-shockwave-flash" data="' + urlp + '"><param name="movie" id="swfm" value="' + urlp + '" id="pars" /><param name="wmode" value="opaque" /><param name="quality" value="high" /><embed src="' + urlp + '" id="fem" width="550" height="400" quality="high" wmode="opaque" type="application/x-shockwave-flash" pluginspage="https://ruffle.rs/downloads" /></object>'
        }
    </script>
</body>
</html>